---
title: "Delaunay triangulation Spoken"
author: "Helio"
date: "2022-12-30"
output: html_document
---


ROTATE STIMULI and ALLIgn

```{r}
colnames(df_OF_output_AUsW_unblind_spoken1_binned)
df_OF_output_AUsW_unblind_spoken1_binned
range(df_OF_output_AUsW_unblind_spoken1_binned$bin_frame)

# select_AUS and landmarks

colnames(df_OF_output)

df_OF_output_AU_andLand<- df_OF_output[,c(1:5,300:435, 680:715)]
colnames(df_OF_output_AU_andLand)


# create necessary columns
library(stringr)
library(tidyverse)
df_OF_output_AU_andLand$subject<- sub(".*_p", "", str_match(df_OF_output_AU_andLand$filename, "p\\s*(.*?)\\s*.csv")[,2])

df_OF_output_AU_andLand$test.day<- str_match(df_OF_output_AU_andLand$filename, "_day\\s*(.*?)\\s*_p")[,2]

# merge
df_OF_output_AU_andLand$subject<- as.factor(as.character( df_OF_output_AU_andLand$subject))
Unblinding_BMI_drugday$subject<-as.factor(as.character(Unblinding_BMI_drugday$subject))

# expected rows()
# nrow(df_OF_output_AU_andLand)  =131476
df_OF_output_AU_andLand_unblind<- left_join(df_OF_output_AU_andLand, Unblinding_BMI_drugday)

# if test.day == drugday  = "halo, vs placebo
colnames(df_OF_output_AU_andLand_unblind)

df_OF_output_AU_andLand_unblind$drug.placebo <- if_else(df_OF_output_AU_andLand_unblind$test.day == df_OF_output_AU_andLand_unblind$drug.day, "drug", "placebo")

# add emotion
# return word between 3rd and 4rth underscore df$values = sapply(strsplit(df$V1, "_"), function(x) x[3])

df_OF_output_AU_andLand_unblind$expression <-sapply(strsplit(df_OF_output_AU_andLand_unblind$filename, "_"), function(x) x[3])
# 2nd and 3rd undrcore
# unique( sapply(strsplit(df_OF_output_AU_andLand_unblind$filename, "_"), function(x) x[2]))
df_OF_output_AU_andLand_unblind$posed.spoken<- sapply(strsplit(df_OF_output_AU_andLand_unblind$filename, "_"), function(x) x[2])

cname2<-c(cnames1[1:5],t(AU_OF_codes_merged$AU_Code_OF_r),t(AU_OF_codes_merged$AU_Code_OF_c), "filename")
# cnames1
# t(AU_OF_codes_merged$AU_Code_OF_r)
# note OF addded a new action fpr presence 28 (lipsuck) I will exclude this for now
df_OF_output_AU_andLand_unblind$AU28_c<-NULL

# df_OF_output_AUstest<-df_OF_output_AUs
# names(df_OF_output_AUstest)<- cname2

colnames(df_OF_output_AU_andLand_unblind)
names(df_OF_output_AU_andLand_unblind)[142:175]<- cname2[6:39]
colnames(df_OF_output_AU_andLand_unblind)


# binify
unique(df_OF_output_AU_andLand_unblind$posed.spoken)
df_OF_output_AU_andLand_unblind_spoken_binned <-df_OF_output_AU_andLand_unblind%>%
  subset(posed.spoken == "spoken")%>%
  group_by(filename, subject,test.day, age, gender,BMI,drug.day, drug.placebo, expression,posed.spoken )%>%
  mutate(bin_frame = cut(frame, 100, labels = FALSE))%>%
  group_by(filename,bin_frame,subject,test.day, age, gender,BMI,drug.day, drug.placebo, expression,posed.spoken)%>%
  summarise_if(is.numeric, mean, na.rm = TRUE)

colnames(df_OF_output_AU_andLand_unblind_spoken_binned)

# gather lamndmarks
require(data.table)
df_OF_output_andLand_unblind_spoken_binned_dcast<- df_OF_output_AU_andLand_unblind_spoken_binned[,-c(153:186)] %>%
group_by(filename)%>%
  gather(key, value, -c(1:16)) %>%
  mutate(coordinate = substr(key,1,1))%>%
  mutate(lanmark_id = substr(key,3,4)) %>%
  setDT%>%  dcast(filename+bin_frame+timestamp+subject+test.day+ age +gender +BMI + drug.day + drug.placebo+
          expression+posed.spoken+confidence+success+lanmark_id~coordinate, value.var = "value",  mean)


df_OF_output_andLand_unblind_spoken_binned_dcast<-df_OF_output_andLand_unblind_spoken_binned_dcast%>%
  group_by(filename)%>%
  arrange(as.numeric(lanmark_id))


df_OF_output_AU_andLand_unblind_spoken_binned

df_OF_output_andLand_unblind_spoken_binned_dcast
```

rotate landmarks to align eyes and normalise position to remove gross movement
```{r}
# create a unique ID fr frame and stim

df_OF_output_andLand_unblind_spoken_binned_dcast$Stimuli_frame <- paste0(df_OF_output_andLand_unblind_spoken_binned_dcast$filename,df_OF_output_andLand_unblind_spoken_binned_dcast$bin_frame)

filename_unique<-unique(df_OF_output_andLand_unblind_spoken_binned_dcast$Stimuli_frame)
colnames(df_OF_output_andLand_unblind_spoken_binned_dcast)
f = 1

temp_df_bind<- data.frame() # e empty dataframe to store results

for (f in 1:length(filename_unique)) {
  # f = 2
  # video = filename_video[f]
  temp_df <- df_OF_output_andLand_unblind_spoken_binned_dcast%>%
    subset(Stimuli_frame == filename_unique[f])
  
    # start
  message(paste0("running video no_: ", f), paste0("_",filename_unique[f]))


  
  # First, isolate the points of interest (the subject's left and right eyes)
  left_eye  <- temp_df[temp_df$lanmark_id == 42,]
  right_eye <- temp_df[temp_df$lanmark_id == 39,] 
  
  # now find the difference in the y co-ordinates and x co-ordinates between these two points:
  diff_x <- left_eye$x - right_eye$x
  diff_y <- left_eye$y - right_eye$y
  
   message(paste0("angle - ratio - transform"))
  # The arctangent of the ratio will be the angle you need to rotate all the points by:
  theta  <- atan2(-diff_y, diff_x)
  
# print("matrix") 
# To transform the points, you need to create a rotation matrix, which is a specific two-by-two matrix which you can use to rotate the original points:
# 
# enter image description here - https://stackoverflow.com/questions/74493141/align-x-and-y-coordinates-of-face-landmarks-in-r/74493424?noredirect=1#comment131500839_74493424
  
  mat <- matrix(c(cos(theta), sin(theta), -sin(theta), cos(theta)), 2)

# Now we multiply each x, y point by this matrix to get our rotated points, and write it back into our original data frame:
  temp_df$x_new_norm_rot <- t(apply(temp_df[,16:17], 1, function(x) mat %*% x))[,1]
  temp_df$y_new_norm_rot <- t(apply(temp_df[,16:17], 1, function(x) mat %*% x))[,2] 
   
  message(paste0("bind datasets"))
  
    temp_df_bind<- bind_rows(temp_df_bind,temp_df)
}

temp_df_bind
# unique(temp_df_bind$filename)
unique(temp_df_bind$filename)

temp_df_bind

df_OF_output_land_spoken_binned_select_alligned_eyes<- temp_df_bind


```

Now compute displacement for landmarks
```{r}
require(tidyverse)
df_OF_output_land_spoken_binned_select_alligned_eyes<-

df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  mutate(lanmark_id = as.numeric(lanmark_id))%>%
  group_by(filename)%>%
  arrange(lanmark_id)%>%
  # group_by(filename, expression,lanmark_id)%>%
 group_by(filename, bin_frame)%>%
  mutate(x_new_norm_rot2 = maxnormalize(x_new_norm_rot),
         y_new_norm_rot2 = maxnormalize(y_new_norm_rot))%>%
  # compute landmark differences
  group_by(filename,lanmark_id)%>%
  mutate(x_norm_diff= x_new_norm_rot2 - lag(x_new_norm_rot2),
         y_norm_diff= y_new_norm_rot2 - lag(y_new_norm_rot2))%>%
# %>%
    mutate(x_norm_diff_abs= (x_norm_diff),#decide wherher to absolute or not, i cut the abs for now
         y_norm_diff_abs= (y_norm_diff))%>%

  # compute a sum - also consider a rolling sum

  mutate(fill_x_y_sum = (x_norm_diff_abs+y_norm_diff_abs)/2) %>%
  # this is what we are goint to use to colour pints
  
  group_by(filename,lanmark_id)%>%
  
  #the line below just ignores NA (introduced in lag) which would throw error to cumsum otehrwise
      mutate(cum_x_norm_abs_diff = cumsum(ifelse(is.na(x_norm_diff_abs), 0, x_norm_diff_abs)) + x_norm_diff_abs*0,
             cum_y_norm_abs_diff = cumsum(ifelse(is.na(y_norm_diff_abs), 0, y_norm_diff_abs)) + y_norm_diff_abs*0)%>%
  mutate(cum_x_y_norm_abs_diff_mean_fill = ((cum_x_norm_abs_diff+cum_y_norm_abs_diff)/2))%>%
  mutate(fill_x_y_sum2 = sum(fill_x_y_sum))%>%

  # normalise the fills
  group_by(subject, lanmark_id)%>%
  mutate(cum_x_y_norm_abs_diff_mean_fill_norm = maxnormalize(cum_y_norm_abs_diff))%>%
          # ungroup()%>% 
         
        mutate(fill_x_y_sum_norm = maxnormalize(fill_x_y_sum),
               # fill_x_y_sum_norm2 = maxnormalize(fill_x_y_sum2)
               )


df_OF_output_land_spoken_binned_select_alligned_eyes$fill_x_y_sum
```

# summarise for delaunay triangles and voronoi plots

```{r}

# range(df_OF_output_AUsW_unblind_spoken1_binned$bin_frame)
colnames(df_OF_output_land_spoken_binned_select_alligned_eyes)
df_OF_output_land_spoken_binned_select_alligned_eyes
colnames(df_OF_output_AUsW_unblind_spoken1_binned)

df_OF_output_AUsW_unblind_spoken1_binned

df_OF_output_land_spoken_binned_select_alligned_eyes<- left_join(df_OF_output_land_spoken_binned_select_alligned_eyes,
df_OF_output_AUsW_unblind_spoken1_binned[,c(1,2:3,10,34:36)])



# store component with correwct names

df_OF_output_land_spoken_binned_select_alligned_eyes$comp1<-df_OF_output_land_spoken_binned_select_alligned_eyes$k3_comp1

df_OF_output_land_spoken_binned_select_alligned_eyes$comp2<-df_OF_output_land_spoken_binned_select_alligned_eyes$k3_comp2

df_OF_output_land_spoken_binned_select_alligned_eyes$comp3<-df_OF_output_land_spoken_binned_select_alligned_eyes$k3_comp3

require(ggforce)
df_OF_output_land_spoken_binned_select_alligned_eyes<-
df_OF_output_land_spoken_binned_select_alligned_eyes %>%
    # subset(subject == 1)%>% 
 # filter(bin_frame>40 & bin_frame<75)%>%
 # filter(bin_frame>10 & bin_frame<60)%>%
  group_by(filename)%>%
  mutate(comp1_normmax = maxnormalize(comp1),
         comp2_normmax = maxnormalize(comp2),
         comp3_normmax = maxnormalize(comp3)
         
         )
  
    # mutate(comp1_NMFLand = maxnormalize(comp1_NMFLand),
         # comp2_NMFLand = maxnormalize(comp2_NMFLand),
         # comp3_NMFLand = maxnormalize(comp3_NMFLand)
         
         # )
# %>%
  # mutate(coef_fill = (comp1_normmax+comp2_normmax+comp3_normmax)*(nmf_land_value_norm1 +
                                                                    # nmf_land_value_norm2+nmf_land_value_norm3))%>%
  
    mutate(coef_fill =  (comp1_normmax+comp2_normmax+comp3_normmax)/3)%>% #+(nmf_land_value_norm1 *
                                                                    # nmf_land_value_norm2*nmf_land_value_norm3))%>%
  
# explore specific subj
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
  ggplot(aes(x = x_new_norm_rot2, y = 1-y_new_norm_rot2, fill = coef_fill,
               colour = coef_fill))+
   geom_voronoi_tile(aes(fill = coef_fill), colour =NA)+
   geom_point(aes(y = 1-y_new_norm_rot2), colour = "white",size = .5,alpha = .5)+
     scale_color_viridis_c(option = "magma")+
  scale_fill_viridis_c(option = "magma")+
    facet_grid(~expression)+
  geom_hline(yintercept = 1)


# visualise just one component
df_OF_output_land_spoken_binned_select_alligned_eyes %>%
    subset(subject == 1)%>% 
 # filter(bin_frame>40 & bin_frame<75)%>%
 filter(bin_frame>10 & bin_frame<60)%>%
  group_by(filename)%>%
  mutate(comp1_normmax = maxnormalize(comp1),
         comp2_normmax = maxnormalize(comp2),
         comp3_normmax = maxnormalize(comp3)
         
         )%>%
  
    # mutate(comp1_NMFLand = maxnormalize(comp1_NMFLand),
    #      comp2_NMFLand = maxnormalize(comp2_NMFLand),
    #      comp3_NMFLand = maxnormalize(comp3_NMFLand)
         
         # )%>%
  # mutate(coef_fill = (comp1_normmax+comp2_normmax+comp3_normmax)*(nmf_land_value_norm1 +
                                                                    # nmf_land_value_norm2+nmf_land_value_norm3))%>%
  
    mutate(coef_fill =  cum_x_y_norm_abs_diff_mean_fill_norm *(comp1_normmax ))%>%
  # %>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
  ggplot(aes(x = x_new_norm_rot2, y = 1-y_new_norm_rot2, fill = coef_fill,
               colour = coef_fill))+
   geom_voronoi_tile(aes(fill = coef_fill), colour =NA)+
   geom_point(aes(y = 1-y_new_norm_rot2), colour = "white",size = .5,alpha = .5)+
     scale_color_viridis_c(option = "magma")+
  scale_fill_viridis_c(option = "magma")+
    facet_grid(~expression)+
  geom_hline(yintercept = 1)


df_OF_output_land_spoken_binned_select_alligned_eyes
```

map component to landmark weights


```{r}

nrow(df_OF_output_land_spoken_binned_select_alligned_eyes)
# maybe we don't need to dcast

colnames(df_OF_output_land_spoken_binned_select_alligned_eyes)


range(df_OF_output_land_spoken_binned_select_alligned_eyes$cum_x_y_norm_abs_diff_mean_fill_norm, na.rm = T)

# if_else(is.na(df_OF_output_land_spoken_binned_select_alligned_eyes$cum_x_y_norm_abs_diff_mean_fill_norm) == TRUE,0,df_OF_output_land_spoken_binned_select_alligned_eyes$cum_x_y_norm_abs_diff_mean_fill_norm )
options(scipen = 999)
df_OF_output_land_spoken_binned_select_alligned_eyes$comp3_normmax

df_OF_output_land_spoken_binned_select_alligned_eyes<-
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  ungroup()%>%
  mutate(cum_x_y_norm_abs_diff_mean_fill_norm =
           if_else(is.na(cum_x_y_norm_abs_diff_mean_fill_norm) == TRUE, 0,
                   cum_x_y_norm_abs_diff_mean_fill_norm)) %>%
  group_by(expression, lanmark_id)%>% #consider grouping it by file too
  mutate(cor_comp1_land_cum_diff_fill = cor(cum_x_y_norm_abs_diff_mean_fill_norm,comp1_normmax,use = "complete.obs"),
    cor_comp2_land_cum_diff_fill = cor(cum_x_y_norm_abs_diff_mean_fill_norm,comp2_normmax,use = "complete.obs"), 
    cor_comp3_land_cum_diff_fill = cor(cum_x_y_norm_abs_diff_mean_fill_norm,comp3_normmax, use = "complete.obs"))%>%
  
  # timeseries correlation accounting rom timedependance
  # fill_x_y_sum_norm
  mutate(cor_comp1_land_diff_fill =
  cor(fill_x_y_sum_norm,comp1_normmax,use = "complete.obs"),
    cor_comp2_land_diff_fill = cor(fill_x_y_sum_norm,comp2_normmax,use = "complete.obs"), 
    cor_comp3_land_diff_fill = cor(fill_x_y_sum_norm,comp3_normmax, use = "complete.obs"))
  


```


```{r}
# install.packages("dtw")
library(dtw)
# Next, create two time series
time1 <- seq(1, 10, by = 0.1)
time2 <- seq(1, 10, by = 0.1)

# Add some noise to the time series
series1 <- sin(time1) + rnorm(length(time1), 0, 0.1)
series2 <- sin(time2) + rnorm(length(time2), 0, 0.1)

# Calculate the DTW distance between the two time series
dtw_distance <- dtw(series1, series2, keep=TRUE)

# Print the DTW distance
print(dtw_distance)

dtw_distance$distance


library(stats)

# Calculate the cross-correlation
cross_correlation <- ccf(series1, series2)
mean(cross_correlation)

mean(cross_correlation$acf)


# Copy code
# Load the required libraries
library(tidyverse)
library(nlme)

# Load the time series data
timeseries1 <- read_csv("timeseries1.csv")
timeseries2 <- read_csv("timeseries2.csv")

# Fit a GLS model to the time series data
time<- 1:91
model <- gls(series2 ~ series1, correlation = corAR1(form = ~ time))

# Extract the correlation coefficient from the model

nlme::`coef<-`()

model$modelStruct
model$dims
model$coefficients
model$
correlation <- corCoef(model)


# Another option is to use the corARMA function from the tsDyn library, which can also account for within-dependence when calculating the correlation between two time series. Here is an example of how you can use it:

# Copy code
# Load the required libraries
library(tidyverse)
# install.packages("tsDyn")
library(tsDyn)


# Calculate the correlation between the two time series

tsDyn::c
correlation <- corARMA(series1, series2)

 # tsDyn::(series1, series2)

# Print the correlation
print(correlation)


# To calculate the correlation between two time series while accounting for within-series dependence in R, you can use a method called "autocorrelation-consistent covariance matrix estimation". This method estimates the covariance matrix of the two time series, taking into account the within-series dependence in each time series. The sample covariance matrix can then be used to calculate the correlation between the two time series.



# Load the plm package
# install.packages("plm")
library(plm)

# Create a panel data object with the time series data

pdata.frame()
time_series_data<- df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  subset(filename == "./cut_spoken_sad_day2_p7.csv")

time_series_data1<- time_series_data%>%subset(lanmark_id == 1)
df_OF_output_land_spoken_binned_select_alligned_eyes

time_series_data1%>%
  ggplot(aes(bin_frame, fill_x_y_sum_norm))+
  geom_line()+
  geom_line(aes(y = comp1_normmax))+
  geom_line(aes(y = fill_x_y_sum_norm), colour = "blue")
  


```

time_series_data1$cum_x_y_norm_abs_diff_mean_fill_norm
colnames(time_series_data1)
panel_data <- pdata.frame(time_series_data1, index = c("bin_frame", "comp1_normmax",'fill_x_y_sum_norm'))

time_series_data1$fill_x_y_sum_norm
time_series_data1$fi

# Estimate the autocorrelation-consistent covariance matrix
acov <- vcovHC(panel_data, type = "HC1")

# Calculate the correlation between the two time series
correlation <- cor(acov)

# Print the correlation
print(correlation)
```{r}



df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  group_by(lanmark_id)%>%
  summarise_if(is.numeric, mean, narm = TRUE)%>%
  select(lanmark_id,cor_comp1_land_cum_diff_fill,cor_comp2_land_cum_diff_fill,cor_comp3_land_cum_diff_fill)%>%
  gather(key,value,-lanmark_id)%>%
  ggplot(aes(lanmark_id,key,fill = value^2))+
  geom_tile()+
  scale_fill_viridis_c(option = "magma")


# comp1
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  mutate(cor_comp1_land_cum_diff_fill_sq = cor_comp1_land_cum_diff_fill^2,
         cor_comp2_land_cum_diff_fill_sq = cor_comp2_land_cum_diff_fill^2,
         cor_comp3_land_cum_diff_fill_sq = cor_comp3_land_cum_diff_fill^2
         )%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
   mutate(coef_fill =  cum_x_y_norm_abs_diff_mean_fill_norm *(cor_comp1_land_cum_diff_fill_sq ))%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
  ggplot(aes(x = x_new_norm_rot2, y = 1-y_new_norm_rot2, fill = coef_fill,
               colour = coef_fill))+
   geom_voronoi_tile(aes(fill = coef_fill), colour =NA)+
   geom_point(aes(y = 1-y_new_norm_rot2), colour = "white",size = .5,alpha = .5)+
     scale_color_viridis_c(option = "magma")+
  scale_fill_viridis_c(option = "magma")+
    facet_grid(~expression)+
  geom_hline(yintercept = 1)

# comp2
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  mutate(cor_comp1_land_cum_diff_fill_sq = cor_comp1_land_cum_diff_fill^2,
         cor_comp2_land_cum_diff_fill_sq = cor_comp2_land_cum_diff_fill^2,
         cor_comp3_land_cum_diff_fill_sq = cor_comp3_land_cum_diff_fill^2
         )%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
   mutate(coef_fill =  cum_x_y_norm_abs_diff_mean_fill_norm *(cor_comp2_land_cum_diff_fill_sq ))%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
  ggplot(aes(x = x_new_norm_rot2, y = 1-y_new_norm_rot2, fill = coef_fill,
               colour = coef_fill))+
   geom_voronoi_tile(aes(fill = coef_fill), colour =NA)+
   geom_point(aes(y = 1-y_new_norm_rot2), colour = "white",size = .5,alpha = .5)+
     scale_color_viridis_c(option = "magma")+
  scale_fill_viridis_c(option = "magma")+
    facet_grid(~expression)+
  geom_hline(yintercept = 1)

# comp3
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  mutate(cor_comp1_land_cum_diff_fill_sq = cor_comp1_land_cum_diff_fill^2,
         cor_comp2_land_cum_diff_fill_sq = cor_comp2_land_cum_diff_fill^2,
         cor_comp3_land_cum_diff_fill_sq = cor_comp3_land_cum_diff_fill^2
         )%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
   mutate(coef_fill =  cum_x_y_norm_abs_diff_mean_fill_norm *(cor_comp3_land_cum_diff_fill_sq ))%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
  ggplot(aes(x = x_new_norm_rot2, y = 1-y_new_norm_rot2, fill = coef_fill,
               colour = coef_fill))+
   geom_voronoi_tile(aes(fill = coef_fill), colour =NA)+
   geom_point(aes(y = 1-y_new_norm_rot2), colour = "white",size = .5,alpha = .5)+
     scale_color_viridis_c(option = "magma")+
  scale_fill_viridis_c(option = "magma")+
    facet_grid(~expression)+
  geom_hline(yintercept = 1)


# just expressions

df_OF_output_land_spoken_binned_select_alligned_eyes<- df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  mutate(cor_comp1_land_cum_diff_fill_sq = cor_comp1_land_cum_diff_fill^2,
         cor_comp2_land_cum_diff_fill_sq = cor_comp2_land_cum_diff_fill^2,
         cor_comp3_land_cum_diff_fill_sq = cor_comp3_land_cum_diff_fill^2
         )%>%
  
  
  # cor_comp1_land_diff_fill no cummulative
    mutate(cor_comp1_land_diff_fill_sq = cor_comp1_land_diff_fill^2,
         cor_comp2_land_diff_fill_sq = cor_comp2_land_diff_fill^2,
         cor_comp3_land_diff_fill_sq = cor_comp3_land_diff_fill^2
         )


```


```{r eval=FALSE, include=FALSE}
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  ungroup()%>%
  group_by(filename)%>%
  mutate(cor_comp1_land_cum_diff_fill_sq_max_norm = maxnormalize(cor_comp1_land_cum_diff_fill_sq),
         cor_comp2_land_cum_diff_fill_sq_max_norm = maxnormalize(cor_comp2_land_cum_diff_fill_sq),
         cor_comp3_land_cum_diff_fill_sq_max_norm = maxnormalize(cor_comp3_land_cum_diff_fill_sq))%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
   mutate(coef_fill =  cum_x_y_norm_abs_diff_mean_fill_norm* ((cor_comp1_land_cum_diff_fill_sq_max_norm+cor_comp2_land_cum_diff_fill_sq_max_norm+
   cor_comp3_land_cum_diff_fill_sq_max_norm)/3))%>% #*(cor_comp3_land_cum_diff_fill_sq ))%>%
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)%>%
  ggplot(aes(x = x_new_norm_rot2, y = 1-y_new_norm_rot2, fill = coef_fill,
               colour = coef_fill))+
   geom_voronoi_tile(aes(fill = coef_fill), colour =NA)+
   geom_point(aes(y = 1-y_new_norm_rot2), colour = "white",size = .5,alpha = .5)+
     scale_color_viridis_c(option = "magma")+
  scale_fill_viridis_c(option = "magma")+
    facet_grid(~expression)+
  geom_hline(yintercept = 1)

```

# maxnorm squared


```{r}
require(tidyverse)
fill_x_y_sum_norm
df_OF_output_land_spoken_binned_select_alligned_eyes<-
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  ungroup()%>%
  group_by(filename)%>%
   mutate(cor_comp1_land_cum_diff_fill_max = maxnormalize(cor_comp1_land_cum_diff_fill),
         cor_comp2_land_cum_diff_fill_max = maxnormalize(cor_comp2_land_cum_diff_fill),
         cor_comp3_land_cum_diff_fill_max = maxnormalize(cor_comp3_land_cum_diff_fill))%>%
   # cor_comp1_land_diff_fill
     mutate(cor_comp1_land_diff_fill_max = maxnormalize(cor_comp1_land_diff_fill),
         cor_comp2_land_diff_fill_max = maxnormalize(cor_comp2_land_diff_fill),
         cor_comp3_land_diff_fill_max = maxnormalize(cor_comp3_land_diff_fill))%>%
  
  
  # cor_comp1_land_diff_fill_sq
  
  mutate(cor_comp1_land_diff_fill_sq_max_norm = maxnormalize(cor_comp1_land_diff_fill_sq),
         cor_comp2_land_diff_fill_sq_max_norm = maxnormalize(cor_comp2_land_diff_fill_sq),
         cor_comp3_land_diff_fill_sq_max_norm = maxnormalize(cor_comp3_land_diff_fill_sq))

```

delaunay plots


```{r}
-
# colnames(df_OF_output_land_spoken_binned_select_alligned_eyes)
  options(scipen = 999)
 unique( df_OF_output_land_spoken_binned_select_alligned_eyes$cor_comp1_land_diff_fill_sq_max_norm)

df_OF_output_land_spoken_binned_select_alligned_eyes_agg<-
df_OF_output_land_spoken_binned_select_alligned_eyes%>%
  
  # cor_comp1_land_cum_diff_fill_sq_max_norm
  mutate(coef_fill =
           cum_x_y_norm_abs_diff_mean_fill_norm* ((cor_comp1_land_cum_diff_fill_sq_max_norm+cor_comp2_land_cum_diff_fill_sq_max_norm+cor_comp3_land_cum_diff_fill_sq_max_norm)/3))%>%
  
  # cor_comp1_land_diff_fill_sq_max_norm
  # we don't need to include diff because it is inclued in the correlation already?
  mutate(coef_fill_nocmm = fill_x_y_sum_norm*((cor_comp1_land_diff_fill_sq_max_norm+ +cor_comp2_land_diff_fill_sq_max_norm+cor_comp3_land_diff_fill_sq_max_norm)/3))%>%
  
  
  
  # cor_comp1_land_cum_diff_fill_max
   mutate(coef_fill_nosq =cum_x_y_norm_abs_diff_mean_fill_norm* ((cor_comp1_land_cum_diff_fill_max+cor_comp2_land_cum_diff_fill_max+cor_comp3_land_cum_diff_fill_max)/3))%>%
  
   mutate(coef_fill_nosq_no_cmm = fill_x_y_sum_norm*((cor_comp1_land_diff_fill_max +cor_comp2_land_diff_fill_max+cor_comp3_land_diff_fill_max)/3))%>%
  
  group_by(filename)%>%
  
  mutate(coef_fill_max_norm = maxnormalize(coef_fill))%>%
  mutate(coef_fill_max_norm_nosq = maxnormalize(coef_fill_nosq))%>%

  mutate(coef_fill_nocmm_max_norm = maxnormalize(coef_fill_nocmm))%>%
      mutate(coef_fill_nosq_no_cmm_max_norm = maxnormalize(coef_fill_nosq_no_cmm))%>%
  
  group_by(expression, lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)


df_OF_output_land_spoken_binned_select_alligned_eyes_agg

```



```{r}
library(deldir)

df_OF_output_land_spoken_binned_select_alligned_eyes_agg

tri_data<-list()


tri_data$tri_data_spoken_all<-
triang.list(deldir(df_OF_output_land_spoken_binned_select_alligned_eyes_agg$x_new_norm_rot2, 
                          df_OF_output_land_spoken_binned_select_alligned_eyes_agg$y_new_norm_rot2))

delaunay_spoken<-list()

delaunay_spoken$delaunay_tri_all_spoken

# 
do.call(rbind, lapply(seq_along(tri_data$tri_data_spoken_all), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_data$tri_data_spoken_all[[x]]$x, y_new_norm_rot2 = tri_data$tri_data_spoken_all[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg$coef_fill[tri_data$tri_data_spoken_all[[x]]$ptNum]),
             tri = x)
  })) |>
  # mutate(count = 1:1518)%>%
  # mutate(expression = cut(count,3, labels = c("anger", "happiness", "sadness")))%>%
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  geom_polygon(aes(fill = coef_fill, group = tri)) +

  geom_point(aes(colour = coef_fill))+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")
#   facet_grid(~expression)
# 
# delaunay_tri_all

View(delaunay_tri_all)

```





expressions


```{r}
df_OF_output_land_spoken_binned_select_alligned_eyes_agg$expression

delaunay_spoken_data<-list()

delaunay_spoken_data$anger_del<-subset(df_OF_output_land_spoken_binned_select_alligned_eyes_agg,
                expression == "angry")

delaunay_spoken_data$anger_del

delaunay_spoken_data$happy_del<-subset(df_OF_output_land_spoken_binned_select_alligned_eyes_agg,
                expression == "happy")


delaunay_spoken_data$sad_del<-subset(df_OF_output_land_spoken_binned_select_alligned_eyes_agg,
                expression == "sad")

unique(df_OF_output_land_spoken_binned_select_alligned_eyes_agg$expression)
delaunay_spoken_data$neutral_del<-subset(df_OF_output_land_spoken_binned_select_alligned_eyes_agg,
                expression == "neutral")



```

Spoken anger delaunay


```{r}


delaunay_spoken_data$tri_ang <- triang.list(deldir(delaunay_spoken_data$anger_del$x_new_norm_rot2, 
                          delaunay_spoken_data$anger_del$y_new_norm_rot2))


tri_angtest <- triang.list(deldir(delaunay_spoken_data$anger_del$x_new_norm_rot2, 
                          delaunay_spoken_data$anger_del$y_new_norm_rot2))


delaunay_spoken_data$tri_ang



# do.call(rbind, lapply(seq_along(tri_ang), 
#                       function(x) {
#   data.frame(x_new_norm_rot2 = tri_ang[[x]]$x, y_new_norm_rot2 = tri_ang[[x]]$y, 
#              coef_fill = mean(anger_del$cum_x_y_norm_abs_diff_mean_fill_norm[tri_ang[[x]]$ptNum]),
#              tri_ang = x)
#   })) |>
#   
#   

# delaunay_spoken_plots<-list()

delaunay_spoken_plots$spoken_triang_ang<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$coef_fill_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")





delaunay_spoken_plots$spoken_triang_ang


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$coef_fill_nocmm_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$coef_fill_nosq_no_cmm_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

```


# cum_x_y_norm_abs_diff_mean_fill_norm

```{r}
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cum_x_y_norm_abs_diff_mean_fill_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang

```
  
# theme(plot.background = element_rect(fill = "black"),
#                                        legend.position = "none")



# comp 1 anger

```{r}


delaunay_spoken_data$anger_del$cor_comp1_land_cum_diff_fill_sq_max_norm

# delaunay_spoken_data$tri_ang <- triang.list(deldir(delaunay_spoken_data$anger_del$x_new_norm_rot2, 
#                           delaunay_spoken_data$anger_del$y_new_norm_rot2))

# 
# tri_angtest <- triang.list(deldir(delaunay_spoken_data$anger_del$x_new_norm_rot2, 
#                           delaunay_spoken_data$anger_del$y_new_norm_rot2))
# 

delaunay_spoken_data$tri_ang

delaunay_spoken_plots$spoken_triang_ang_comp1 <-

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp1_land_cum_diff_fill_sq_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


delaunay_spoken_plots$spoken_triang_ang_comp1


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp1_land_diff_fill_sq_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp1_land_diff_fill_max[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


```

# comp 2

```{r}
delaunay_spoken_plots$spoken_triang_ang_comp2 <-

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp2_land_cum_diff_fill_sq_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp2


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp2_land_diff_fill_sq_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp2_land_diff_fill_max[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

```


# comp 3


```{r}
delaunay_spoken_plots$spoken_triang_ang_comp3 <-

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp3_land_cum_diff_fill_sq_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp3


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp3_land_diff_fill_sq_max_norm[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_ang), 
                      function(x) {
  data.frame(x_new_norm_rot2 = tri_angtest[[x]]$x, 
             y_new_norm_rot2 = tri_angtest[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$anger_del$cor_comp3_land_diff_fill_max[tri_angtest[[x]]$ptNum]),
             tri_angtest = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = tri_angtest)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")


```

require(patchwork)
  delaunay_spoken_plots$spoken_triang_ang/
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)

```

happy

```{r}

delaunay_spoken_data$tri_happy<- triang.list(deldir(delaunay_spoken_data$happy_del$x_new_norm_rot2, 
                          delaunay_spoken_data$happy_del$y_new_norm_rot2))


spoken_tri_happy<- triang.list(deldir(delaunay_spoken_data$happy_del$x_new_norm_rot2, 
                          delaunay_spoken_data$happy_del$y_new_norm_rot2))




delaunay_spoken_plots$spoken_triang_happy<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_happy), 
                      function(x) {
  data.frame(x_new_norm_rot2 = delaunay_spoken_data$tri_happy[[x]]$x, 
             y_new_norm_rot2 = delaunay_spoken_data$tri_happy[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$happy_del$coef_fill_max_norm[
   spoken_tri_happy[[x]]$ptNum]),
             spoken_tri_happy = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_happy)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")




# cum_x_y_norm_abs_diff_mean_fill_norm

delaunay_spoken_plots$spoken_triang_ang

```

```
```{r}
delaunay_spoken_plots$spoken_triang_happy

triangle_plots$delaunay_tri_happy

delaunay_spoken_plots$spoken_triang_ang

triangle_plots$delaunay_tri_ang

delaunay_spoken_plots$spoken_triang_sad

triangle_plots$delaunay_tri_sad

```

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_happy), 
                      function(x) {
  data.frame(x_new_norm_rot2 = delaunay_spoken_data$tri_happy[[x]]$x, 
             y_new_norm_rot2 = delaunay_spoken_data$tri_happy[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$happy_del$cum_x_y_norm_abs_diff_mean_fill_norm[
   spoken_tri_happy[[x]]$ptNum]),
             spoken_tri_happy = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_happy)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

```
  


# comp 1 happy

```{r}


delaunay_spoken_data$happy_del$cor_comp1_land_cum_diff_fill_sq_max_norm

# delaunay_spoken_data$tri_happy<- triang.list(deldir(delaunay_spoken_data$happy_del$x_new_norm_rot2, 
#                           delaunay_spoken_data$happy_del$y_new_norm_rot2))

# 
# tri_angtest <- triang.list(deldir(delaunay_spoken_data$happy_del$x_new_norm_rot2, 
#                           delaunay_spoken_data$happy_del$y_new_norm_rot2))
# 

delaunay_spoken_data$tri_ang

delaunay_spoken_plots$spoken_triang_happy_comp1 

delaunay_spoken_plots$spoken_triang_ang_comp1 

delaunay_spoken_plots$spoken_triang_happy_comp1 <-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_happy), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_happy[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_happy[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$happy_del$cor_comp1_land_cum_diff_fill_sq_max_norm[spoken_tri_happy[[x]]$ptNum]),
             spoken_tri_happy = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_happy)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")
delaunay_spoken_plots$spoken_triang_ang_comp1
delaunay_spoken_plots$spoken_triang_happy_comp1

```



# comp 2

```{r}
delaunay_spoken_plots$spoken_triang_happy_comp2 <-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_happy), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_happy[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_happy[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$happy_del$cor_comp2_land_cum_diff_fill_sq_max_norm[spoken_tri_happy[[x]]$ptNum]),
             spoken_tri_happy = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_happy)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp2
delaunay_spoken_plots$spoken_triang_happy_comp2


```

# comp 3

```{r}
delaunay_spoken_plots$spoken_triang_happy_comp3 <-

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_happy), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_happy[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_happy[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$happy_del$cor_comp3_land_cum_diff_fill_sq_max_norm[spoken_tri_happy[[x]]$ptNum]),
             spoken_tri_happy = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_happy)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp3
delaunay_spoken_plots$spoken_triang_happy_comp3

```

```{r}
require(patchwork)
  delaunay_spoken_plots$spoken_triang_ang/
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)/
     delaunay_spoken_plots$spoken_triang_happy/
    (delaunay_spoken_plots$spoken_triang_happy_comp1|delaunay_spoken_plots$spoken_triang_happy_comp2|delaunay_spoken_plots$spoken_triang_happy_comp3)
  
  # i gues of we do the corelation per filename, we can get comp[onents that vary per expression]

```


SAD


```{r}

delaunay_spoken_data$tri_sad<- triang.list(deldir(delaunay_spoken_data$sad_del$x_new_norm_rot2, 
                          delaunay_spoken_data$sad_del$y_new_norm_rot2))


spoken_tri_sad<- triang.list(deldir(delaunay_spoken_data$sad_del$x_new_norm_rot2, 
                          delaunay_spoken_data$sad_del$y_new_norm_rot2))




delaunay_spoken_plots$spoken_triang_sad<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_sad), 
                      function(x) {
  data.frame(x_new_norm_rot2 = delaunay_spoken_data$tri_sad[[x]]$x, 
             y_new_norm_rot2 = delaunay_spoken_data$tri_sad[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$sad_del$coef_fill_max_norm[
   spoken_tri_sad[[x]]$ptNum]),
             spoken_tri_sad = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_sad)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang
delaunay_spoken_plots$spoken_triang_happy
delaunay_spoken_plots$spoken_triang_sad

```
  


# comp 1 sad

```{r}


delaunay_spoken_data$sad_del$cor_comp1_land_cum_diff_fill_sq_max_norm




delaunay_spoken_plots$spoken_triang_sad_comp1 <-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_sad), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_sad[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_sad[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$sad_del$cor_comp1_land_cum_diff_fill_sq_max_norm[spoken_tri_sad[[x]]$ptNum]),
             spoken_tri_sad = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_sad)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")
delaunay_spoken_plots$spoken_triang_ang_comp1
delaunay_spoken_plots$spoken_triang_happy_comp1
delaunay_spoken_plots$spoken_triang_sad_comp1

```



# comp 2

```{r}
delaunay_spoken_plots$spoken_triang_sad_comp2 <-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_sad), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_sad[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_sad[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$sad_del$cor_comp2_land_cum_diff_fill_sq_max_norm[spoken_tri_sad[[x]]$ptNum]),
             spoken_tri_sad = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_sad)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp2
delaunay_spoken_plots$spoken_triang_happy_comp2
delaunay_spoken_plots$spoken_triang_sad_comp2


```

# comp 3

```{r}
delaunay_spoken_plots$spoken_triang_sad_comp3 <-

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_sad), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_sad[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_sad[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$sad_del$cor_comp3_land_cum_diff_fill_sq_max_norm[spoken_tri_sad[[x]]$ptNum]),
             spoken_tri_sad = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_sad)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp3
delaunay_spoken_plots$spoken_triang_happy_comp3
delaunay_spoken_plots$spoken_triang_sad_comp3

```
all together
```{r}
require(patchwork)
  delaunay_spoken_plots$spoken_triang_ang/
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)/
     delaunay_spoken_plots$spoken_triang_sad/
    (delaunay_spoken_plots$spoken_triang_sad_comp1|delaunay_spoken_plots$spoken_triang_sad_comp2|delaunay_spoken_plots$spoken_triang_sad_comp3)
  
  # i gues of we do the corelation per filename, we can get comp[onents that vary per expression]
  
    delaunay_spoken_plots$spoken_triang_ang/
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)/
     delaunay_spoken_plots$spoken_triang_happy/
    (delaunay_spoken_plots$spoken_triang_happy_comp1|delaunay_spoken_plots$spoken_triang_happy_comp2|delaunay_spoken_plots$spoken_triang_happy_comp3)/ delaunay_spoken_plots$spoken_triang_sad/
    (delaunay_spoken_plots$spoken_triang_sad_comp1|delaunay_spoken_plots$spoken_triang_sad_comp2|delaunay_spoken_plots$spoken_triang_sad_comp3)

```

neutral


neutral


```{r}

delaunay_spoken_data$tri_neutral<- triang.list(deldir(delaunay_spoken_data$neutral_del$x_new_norm_rot2, 
                          delaunay_spoken_data$neutral_del$y_new_norm_rot2))


spoken_tri_neutral<- triang.list(deldir(delaunay_spoken_data$neutral_del$x_new_norm_rot2, 
                          delaunay_spoken_data$neutral_del$y_new_norm_rot2))




delaunay_spoken_plots$spoken_triang_neutral<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_neutral), 
                      function(x) {
  data.frame(x_new_norm_rot2 = delaunay_spoken_data$tri_neutral[[x]]$x, 
             y_new_norm_rot2 = delaunay_spoken_data$tri_neutral[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$neutral_del$coef_fill_max_norm[
   spoken_tri_neutral[[x]]$ptNum]),
             spoken_tri_neutral = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_neutral)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang
delaunay_spoken_plots$spoken_triang_happy
delaunay_spoken_plots$spoken_triang_sad
delaunay_spoken_plots$spoken_triang_neutral

```
  


# comp 1 neutral

```{r}

delaunay_spoken_plots$spoken_triang_neutral_comp1 <-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_neutral), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_neutral[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_neutral[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$neutral_del$cor_comp1_land_cum_diff_fill_sq_max_norm[spoken_tri_neutral[[x]]$ptNum]),
             spoken_tri_neutral = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_neutral)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")
delaunay_spoken_plots$spoken_triang_ang_comp1
delaunay_spoken_plots$spoken_triang_happy_comp1
delaunay_spoken_plots$spoken_triang_sad_comp1
delaunay_spoken_plots$spoken_triang_neutral_comp1

```



# comp 2

```{r}
delaunay_spoken_plots$spoken_triang_neutral_comp2 <-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_neutral), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_neutral[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_neutral[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$neutral_del$cor_comp2_land_cum_diff_fill_sq_max_norm[spoken_tri_neutral[[x]]$ptNum]),
             spoken_tri_neutral = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_neutral)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp2
delaunay_spoken_plots$spoken_triang_happy_comp2
delaunay_spoken_plots$spoken_triang_sad_comp2
delaunay_spoken_plots$spoken_triang_neutral_comp2


```

# comp 3

```{r}
delaunay_spoken_plots$spoken_triang_neutral_comp3 <-

do.call(rbind, lapply(seq_along(delaunay_spoken_data$tri_neutral), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_neutral[[x]]$x, 
             y_new_norm_rot2 = spoken_tri_neutral[[x]]$y, 
 coef_fill = mean(delaunay_spoken_data$neutral_del$cor_comp3_land_cum_diff_fill_sq_max_norm[spoken_tri_neutral[[x]]$ptNum]),
             spoken_tri_neutral = x)
  })) |>
  ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_neutral)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_triang_ang_comp3
delaunay_spoken_plots$spoken_triang_happy_comp3
delaunay_spoken_plots$spoken_triang_sad_comp3

delaunay_spoken_plots$spoken_triang_neutral_comp3

```

all together
```{r}
require(patchwork)
  delaunay_spoken_plots$spoken_triang_ang/
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)/
     delaunay_spoken_plots$spoken_triang_sad/
    (delaunay_spoken_plots$spoken_triang_sad_comp1|delaunay_spoken_plots$spoken_triang_sad_comp2|delaunay_spoken_plots$spoken_triang_sad_comp3)
  
  # i gues of we do the corelation per filename, we can get comp[onents that vary per expression]
  
    delaunay_spoken_plots$spoken_triang_ang/
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)/
     delaunay_spoken_plots$spoken_triang_happy/
    (delaunay_spoken_plots$spoken_triang_happy_comp1|delaunay_spoken_plots$spoken_triang_happy_comp2|delaunay_spoken_plots$spoken_triang_happy_comp3)/ delaunay_spoken_plots$spoken_triang_sad/
    (delaunay_spoken_plots$spoken_triang_sad_comp1|delaunay_spoken_plots$spoken_triang_sad_comp2|delaunay_spoken_plots$spoken_triang_sad_comp3)/
      delaunay_spoken_plots$spoken_triang_neutral/
    (delaunay_spoken_plots$spoken_triang_neutral_comp1|delaunay_spoken_plots$spoken_triang_neutral_comp2|delaunay_spoken_plots$spoken_triang_neutral_comp3)

```

```
components across emotions
```{r}
# COMP1

df_OF_output_land_spoken_binned_select_alligned_eyes_agg2 <-
# colnames(df_OF_output_land_spoken_binned_select_alligned_eyes)
df_OF_output_land_spoken_binned_select_alligned_eyes_agg%>%
  group_by(lanmark_id)%>% #posed.spoken
  summarise_if(is.numeric, mean, na.rm = T)


df_OF_output_land_spoken_binned_select_alligned_eyes_agg2

delaunay_spoken_data$spoken_tri_comp1<-
triang.list(deldir(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$x_new_norm_rot2, 
                          df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$y_new_norm_rot2))


spoken_tri_comp1test<-
triang.list(deldir(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$x_new_norm_rot2, 
                          df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$y_new_norm_rot2))

# delaunay_spoken<-list()

delaunay_spoken_data$spoken_tri_comp1

# 

delaunay_spoken_plots$spoken_tri_comp1<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$spoken_tri_comp1), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_comp1test[[x]]$x, y_new_norm_rot2 = spoken_tri_comp1test[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$cor_comp1_land_cum_diff_fill_sq_max_norm[spoken_tri_comp1test[[x]]$ptNum]),
             spoken_tri_comp1test = x)
  })) |>
  
   ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_comp1test)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")




library(deldir)
delaunay_spoken_plots$spoken_tri_comp1

# delaunay_spoken_plots$spoken_tri_comp1<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$spoken_tri_comp1), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_comp1test[[x]]$x, y_new_norm_rot2 = spoken_tri_comp1test[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$cor_comp1_land_cum_diff_fill_max[spoken_tri_comp1test[[x]]$ptNum]),
             spoken_tri_comp1test = x)
  })) |>
  
   ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_comp1test)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")
  theme_void()+
    theme(legend.position = "none")

```
# comp2

```{r}

delaunay_spoken_plots$spoken_tri_comp2<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$spoken_tri_comp1), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_comp1test[[x]]$x, y_new_norm_rot2 = spoken_tri_comp1test[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$cor_comp2_land_cum_diff_fill_sq_max_norm[spoken_tri_comp1test[[x]]$ptNum]),
             spoken_tri_comp1test = x)
  })) |>
  
   ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_comp1test)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_tri_comp2

do.call(rbind, lapply(seq_along(delaunay_spoken_data$spoken_tri_comp1), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_comp1test[[x]]$x, y_new_norm_rot2 = spoken_tri_comp1test[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$cor_comp2_land_cum_diff_fill_max[spoken_tri_comp1test[[x]]$ptNum]),
             spoken_tri_comp1test = x)
  })) |>
  
   ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_comp1test)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

```


# comp 3
```{r}
delaunay_spoken_plots$spoken_tri_comp3<-
do.call(rbind, lapply(seq_along(delaunay_spoken_data$spoken_tri_comp1), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_comp1test[[x]]$x, y_new_norm_rot2 = spoken_tri_comp1test[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$cor_comp3_land_cum_diff_fill_sq_max_norm[spoken_tri_comp1test[[x]]$ptNum]),
             spoken_tri_comp1test = x)
  })) |>
  
   ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_comp1test)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")+
  theme_void()+
    theme(
                                       legend.position = "none")

delaunay_spoken_plots$spoken_tri_comp1

delaunay_spoken_plots$spoken_tri_comp2

delaunay_spoken_plots$spoken_tri_comp3


do.call(rbind, lapply(seq_along(delaunay_spoken_data$spoken_tri_comp1), 
                      function(x) {
  data.frame(x_new_norm_rot2 = spoken_tri_comp1test[[x]]$x, y_new_norm_rot2 = spoken_tri_comp1test[[x]]$y, 
             coef_fill = mean(df_OF_output_land_spoken_binned_select_alligned_eyes_agg2$cor_comp3_land_cum_diff_fill[spoken_tri_comp1test[[x]]$ptNum]),
             spoken_tri_comp1test = x)
  })) |>
  
   ggplot(aes(x_new_norm_rot2, 1-y_new_norm_rot2)) +
  # tri
  geom_polygon(aes(fill = coef_fill, group = spoken_tri_comp1test)) +

  geom_point(colour = "white", alpha = .5, size = .4)+
    scale_fill_viridis_c(option = "magma")+
    scale_colour_viridis_c(option = "magma")
  theme_void()+
    theme(
                                       legend.position = "none")

```


```{r}

  ((delaunay_spoken_plots$spoken_triang_ang)|
    (delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3))/
     ((delaunay_spoken_plots$spoken_triang_happy)|
    (delaunay_spoken_plots$spoken_triang_happy_comp1|delaunay_spoken_plots$spoken_triang_happy_comp2|delaunay_spoken_plots$spoken_triang_happy_comp3))/ ((delaunay_spoken_plots$spoken_triang_sad)|
    (delaunay_spoken_plots$spoken_triang_sad_comp1|delaunay_spoken_plots$spoken_triang_sad_comp2|delaunay_spoken_plots$spoken_triang_sad_comp3))/
      ((delaunay_spoken_plots$spoken_triang_neutral)|
    (delaunay_spoken_plots$spoken_triang_neutral_comp1|delaunay_spoken_plots$spoken_triang_neutral_comp2|delaunay_spoken_plots$spoken_triang_neutral_comp3))/
  ((plot_spacer())|(delaunay_spoken_plots$spoken_tri_comp1|delaunay_spoken_plots$spoken_tri_comp2|delaunay_spoken_plots$spoken_tri_comp3))
  plot_layout(widths = c(1,1,1,1))

  
  
  ((delaunay_spoken_plots$spoken_triang_ang|
    delaunay_spoken_plots$spoken_triang_ang_comp1|delaunay_spoken_plots$spoken_triang_ang_comp2|delaunay_spoken_plots$spoken_triang_ang_comp3)/
     (delaunay_spoken_plots$spoken_triang_happy|
    delaunay_spoken_plots$spoken_triang_happy_comp1|delaunay_spoken_plots$spoken_triang_happy_comp2|delaunay_spoken_plots$spoken_triang_happy_comp3)/ (delaunay_spoken_plots$spoken_triang_sad|
    delaunay_spoken_plots$spoken_triang_sad_comp1|delaunay_spoken_plots$spoken_triang_sad_comp2|delaunay_spoken_plots$spoken_triang_sad_comp3)/
      (delaunay_spoken_plots$spoken_triang_neutral|
    delaunay_spoken_plots$spoken_triang_neutral_comp1|delaunay_spoken_plots$spoken_triang_neutral_comp2|delaunay_spoken_plots$spoken_triang_neutral_comp3)/
  (plot_spacer()|delaunay_spoken_plots$spoken_tri_comp1|delaunay_spoken_plots$spoken_tri_comp2|delaunay_spoken_plots$spoken_tri_comp3))
```

